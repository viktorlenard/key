{% extends "password/layout.html" %}

{% block body %}

<h1>Â½Password</h1>
<div name="user_entries">
    <h3>Your passwords</h3>
    {% for password in user_passwords %}
        <p id="entry_item">Name</p>
        <li>{{ password.name }}</li>
        <p id="entry_item">URL</p>
        <li>{{ password.url }}</li>
        <p id="entry_item">Username</p>
        <li>{{ password.username }}</li>
        <p id="entry_item">Password</p>
        <li>
            <button class="password-button" data-id="{{ password.id }}">Show Password</button>
            <span class="password-text"></span>
        </li>        
        <p id="entry_item">Tag</p>
        <li>{{ password.tags }}</li>
        <p id="entry_item">Comment</p>
        <li>{{ password.comment }}</li>
        <div>
            --------------------
        </div>
    {% endfor %}
</div>

<!-- Script to handle the toggling of the passwords on the page. 
    When the button is clicked, it fetches the password based on the id
    and changes the button label to 'Hide Password'
    When clicked again it should hide the password and change the label
    back to 'Show Password'.-->

<script>
    document.querySelectorAll('.password-button').forEach(function(button) {
        button.addEventListener('click', function() {
            var passwordId = this.dataset.id;
            var passwordText = this.nextElementSibling;
            if (passwordText.textContent) {
                passwordText.textContent = '';
                this.textContent = 'Show Password';
            } else {
                fetch('/password/get_password/' + passwordId)
                    .then(response => response.text())
                    .then(password => {
                        passwordText.textContent = password;
                        this.textContent = 'Hide Password';
                    });
            }
        });
    });
</script>

<div name="index_div">

    <!-- FORM TO ADD PASSWORD TO DB 
         THIS IS FOR DEBUGGING -->

    <form method="POST" action="", id="add_password_form">
        {% csrf_token %}
        <h3>Add Password</h3>
        Name
        <input type="text" name="name" autofocus placeholder="Name">
        URL
        <input type="text" type="url" name="url" placeholder="URL">
        Username
        <input type="text" name="username" placeholder="Username">
        Password
    {% if generated_password %}
        <input type="text" name="password" value="{{ generated_password }}" placeholder="Generated Password">
    {% else %}
        <input type="text" name="password" placeholder="Password">
    {% endif %}
        Tags
        <select name="tags" id="tags">
            <option value="">None</option>
            <option value="blue">Blue</option>
            <option value="red">Red</option>
            <option value="green">Green</option>
            <option value="yellow">Yellow</option>
            <option value="purple">Purple</option>
          </select>
          <input type="text" name="comment" placeholder="Comment">
          <input name="submit_password" type="submit" value="Add Password" required>
    </form>

    <!-- FORM TO GENERATE PASSWORD FOR ADD PASSWORD ABOVE
         THIS IS FOR DEBUGGING -->

    <form method="POST" action="", id="generate_password_form">
        {% csrf_token %}
        <h3>Generate Password</h3>
        Human
        <input type="checkbox" name="human" id="human">
        Length
        <input type="length" id="length" name="length" min="3" max="8" />
        Divider
        <select name="div" id="div" multiple>
            <option value="-">-</option>
            <option value="_">_</option>
            <option value=".">.</option>
          </select>
        Numbers
        <input type="checkbox" name="nums" id="nums">
        Capitalised
        <input type="checkbox" name="caps" id="caps">
        <input name="generate_password" type="submit" value="Generate" required>
    </form>


    
    <h3>Password</h3>
    <p>{{ password }}</p>
    <p>{{ generated_password }}</p>
</div>
<div>
    <h3>DEBUG</h3>
    <a name="logout_button" href="{% url 'logout' %}">logout as {{ request.user }}</a>
</div>

{% endblock %}
